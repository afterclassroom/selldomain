<div class="container">
	<div class="row">
		<div class="col-sm-12">
			<div class="panel panel-default" style="margin-top: 20px;">
				<div class="panel-heading">
					<h3 class="panel-title">
						Step2: Register Domain:
						<% if session['domain'] %>
						<%= (session['domain']['name']+"."+session['domain']['type']).upcase %>
						<% end %>
					</h3>
				</div>
				<div class="panel-body">
					<div class="row">
						<%= form_tag("/domain_purchases/register_domain", method: "post", :class=>"form-horizontal", :id=>'frm_register_domain') do %>

						<div class="col-sm-8" style="border-right: 3px solid #eee;">

							<h4>Owner Infor</h4>
							<hr>
							<div class="row">
								<div class="col-sm-6">
									<div class="form-group">
										<label class="col-sm-4 control-label">First Name</label>
										<div class="col-sm-8">
											<input class="form-control required" name='contact[fname]' value='Artemus'>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">Last Name</label>
										<div class="col-sm-8">
											<input class="form-control required" name='contact[lname]' value='Gordon'>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">Organization</label>
										<div class="col-sm-8">
											<input class="form-control" name='contact[org]' value='gotoClassroom'>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">Phone</label>
										<div class="col-sm-8">
											<input class="form-control required" name='contact[phone]' value='+1.8885551212'>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">Fax</label>
										<div class="col-sm-8">
											<input class="form-control" name='contact[fax]' value='+1.8885551212'>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">Email</label>
										<div class="col-sm-8">
											<input type="email" class="form-control required email" name='contact[email]' value='info@gotoclassroom.com'>
										</div>
									</div>
								</div>
								<div class="col-sm-6">
									<div class="form-group">
										<label class="col-sm-4 control-label">Address 1</label>
										<div class="col-sm-8">
											<input class="form-control required" name='contact[sa1]' value='2 N. Main St.'>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">Address 2</label>
										<div class="col-sm-8">
											<input class="form-control" name='contact[sa2]'>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">Country</label>
										<div class="col-sm-8">
											<%= select_tag :contact_country, options_for_select(@list_country,0), :name => "contact[cc]", :class => "form-control" %>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">State</label>
										<div class="col-sm-8 state-container">
											<%= select_tag :contact_state, options_for_select(@list_state,0), :name => "contact[sp]", :class => "form-control required" %>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">City</label>
										<div class="col-sm-8">
											<input class="form-control required" name='contact[city]' value='Hamilton'>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-4 control-label">Postal Code</label>
										<div class="col-sm-8">
											<input class="form-control required" name='contact[pc]' value='55555'>
										</div>
									</div>
								</div>
							</div>

							<br><br>
							<div class="row">
								<div class="col-md-9 col-md-offset-3">
									<div class="checkbox checkbox-error">
										<label>
											I accept the terms of the domain registaion agreement
										</label>
										<input type="checkbox" name='contact[agree]' class='required'>

									</div>
									<br>
									<div class="form-group">
										<div class="col-sm-8">
											<button type="submit" class="btn btn-primary">Continue</button>
										</div>
									</div>
								</div>
							</div>
							<% if @error && @error != ''%>
							<div class="row">
								<div class="col-md-9 col-md-offset-3">
									<p style="color: red;"><%= @error%></p>
								</div>
							</div>
							<%end%>
						</div>

						<div class="col-sm-4">

							<h4>Owner Summary</h4>
							<hr>
							<div class="form-group">
								<label class="col-sm-4 control-label">Domain:</label>
								<div class="col-sm-8">
									<p class="form-control-static">
										<a href="">
											<% if session['domain'] %>
											<%= (session['domain']['name']+"."+session['domain']['type']).upcase %>
											<% end %>
										</a>
									</p>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-4 control-label">Period:</label>
								<div class="col-sm-8">
									<select class="form-control" name='order[term]' id='domain-term'>
										<option value="1">1 year</option>
										<option value="2">2 years</option>
										<option value="3">3 years</option>
										<option value="4">4 years</option>
										<option value="5">5 years</option>
										<option value="6">6 years</option>
										<option value="7">7 years</option>
										<option value="8">8 years</option>
										<option value="9">9 years</option>
										<option value="10">10 years</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-4 control-label">Unit Price:</label>
								<div class="col-sm-8">
									<p class="form-control-static">$<span id='unit-price'>undefined</span></p>
									<input id='input-unit-price' type="hidden" name='order[unit_price]' value="undefined">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-4 control-label">Sale Tax:</label>
								<div class="col-sm-8">
									<p class="form-control-static">$<span><%= SALE_TAX%></span></p>
								</div>
							</div>
							<hr>
							<div class="form-group">
								<label class="col-sm-4 control-label">Total Price:</label>
								<div class="col-sm-8">
									<p class="form-control-static">$<span id='total-price'>undefined</span></p>
									<input id='input-total-price' type="hidden" name='order[total_price]' value="undefined">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-4 control-label">Auto Renew:</label>
								<div class="col-sm-8">
									<input type="checkbox" name='order[auto_renew]' value="1" class="g-inline">
								</div>
							</div>
						</div>

						<br><br>

						<%end%>
					</div>

				</div>
			</div>
		</div>
	</div>
</div>

<style>
label.error{
	color: red;
}
.checkbox-error .error{
	display: block;
}
.g-inline{
	position: relative;
	top: 8px;
}
</style>
<script>

var top_level_domain = "<%= session['domain']['type'] %>";
var sale_tax = "<%= SALE_TAX %>";

function getPriceDomain(top_level_domain, num_years) {
	path = '/get_price_domain'
	$.ajax({
		type: "GET",
		url: path,
		data: {
			top_level_domain: top_level_domain,
			num_years: num_years
		},
		success: function(response) {
			response = response.replace("$", "");
			$('#unit-price').html(response);
			$('#input-unit-price').val(response);
			var total_price = (parseFloat(response) + parseFloat(sale_tax)).toPrecision(4);
			$('#total-price').html(total_price);
			$('#input-total-price').val(total_price);
		},
		error: function() {
		}
	});
}

function getState(country) {
	path = '/get_state'
	$.ajax({
		type: "GET",
		url: path,
		data: {
			country: country
		},
		success: function(response) {
			$('.state-container').html(response);
		},
		error: function() {
		}
	});
}


$(function(){

	$('#frm_register_domain').validate_popover({ popoverPosition: 'top' });
	$('#frm_register_domain').validate();

	getPriceDomain(top_level_domain, 1);


	$('#domain-term').change(function(){
		getPriceDomain(top_level_domain, $(this).val());
	});

	$('#contact_country').change(function(){
		$("#contact_state option").remove();
		getState($(this).val());
	});

})
</script>